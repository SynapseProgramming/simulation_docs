\documentclass[11pt]{article}
\usepackage[T1]{fontenc}
\usepackage{listings}
\usepackage{hyperref}
\usepackage{color}

\definecolor{dkgreen}{rgb}{0,0.6,0}
\definecolor{gray}{rgb}{0.5,0.5,0.5}
\definecolor{mauve}{rgb}{0.58,0,0.82}

\lstset{frame=tb,
  language=C++,
  aboveskip=3mm,
  belowskip=3mm,
  showstringspaces=false,
  columns=flexible,
  basicstyle={\small\ttfamily},
  numbers=none,
  numberstyle=\tiny\color{gray},
  keywordstyle=\color{blue},
  commentstyle=\color{dkgreen},
  stringstyle=\color{mauve},
  breaklines=true,
  breakatwhitespace=true,
  tabsize=3
}

\setlength{\parindent}{0pt}
\setlength{\parskip}{0pt plus 0.5ex}
%% adjust spacing for all itemize/enumerate

\begin{document}


\tableofcontents

% TODO: add in more links whenever possible
\section{Useful Resources}
Robot modelling in urdf is rather tedious. Here are a couple of guides/tips which I have found useful.



\begin{itemize}
 \item {
       \href{https://nu-msr.github.io/me495_site/lecture06_modeling.html}{URDF/xacro guide}
       }
 \item{
       \href{   https://classic.gazebosim.org/tutorials?tut=ros_gzplugins}{Guide for gazebo plugins (used to simulate sensors/actuators in gazebo)}
       }
 \item{
       \href{
        https://medium.com/teamarimac/integrating-sonar-and-ir-sensor-plugin-to-robot-model-in-gazebo-with-ros-656fd9452607
       }{Sonar Plugin Guide}
       }
 \item{
       This is a folder which contains many gazebo .world files.
       \begin{lstlisting}[language=bash]
        /usr/share/gazebo-9/worlds
       \end{lstlisting}
       }
       
\end{itemize}


\section{Installation}
\begin{enumerate}
 \item{Install the joint state publisher:
       \begin{lstlisting}[language=bash]
               $ sudo apt install ros-melodic-joint-state-publisher-gui
       \end{lstlisting}
       }
 \item{
       Next, git clone realsense package into your catkin/src folder.
       
       \begin{lstlisting}[language=bash]
       $ git clone https://github.com/pal-robotics/realsense_gazebo_plugin.git
       \end{lstlisting}
       }
       
 \item{
       % https://github.com/SynapseProgramming/map2gazebo.git
       Next, git clone the map2gazebo package into your catkin/src folder
       
       \begin{lstlisting}[language=bash]
       $ git clone https://github.com/SynapseProgramming/map2gazebo.git
       \end{lstlisting}
       }
       
       
 \item{
       Enter the following command into the terminal to setup gazebo environment variables
       \begin{lstlisting}[language=bash]
       $ echo "source /usr/share/gazebo/setup.sh" >> ~/.bashrc
       $ source ~/.bashrc
       \end{lstlisting}
       
       }
 \item{
       Lastly, remember to run the cakin\_make command.
       }
       
       % TODO: add in the fake_world package once done.
\end{enumerate}

\section{Package Overview}
% TODO: add in the worlds file in package overview
\subsection{urdf}
The urdf folder is used to store (.urdf.xacro) and (.gazebo.xacro) files.
\begin{itemize}
 \item {
       (.urdf.xacro) files describe the transformations between the various links of the robot, along with other variables such as intertia.
       }
 \item{
       (.gazebo.xacro) files would describe the kinematic properties of the robot such as velocity limits, coefficient of friction etc.
       }
\end{itemize}
\subsubsection{Intel Realsense D435 camera}
\begin{itemize}
 \item {
       The (\_d435.gazebo.xacro) file is used to describe the various kinematic properties of the depth camera.
       }
 \item{
       The (\_d435.urdf.xacro) file is used to describe the various frames of the depth camera.
       
       The (<camera>\_bottom\_screw\_frame) is used as the main reference point for the depth camera. It is centered about the bottom tripod mount of the depth camera.
       Thus, to define the position of the depth camera on the robot, we would have to provide the transformation from base link to the bottom screw frame link
       }
\end{itemize}

\subsection{meshes}
The meshes folder is used to store the various mesh files of the robot(.stl .dae).
The mesh files are used to visualize various components of the robot(sensors, chassis) and to enable accurate collisions within gazebo.

\subsection{rviz}
The rviz folder is used to store the various rviz configs.

% TODO: update launch section when more launch files are created
\subsection{launch}
\begin{itemize}
 \item{
       
       The launch folder is used to store roslaunch files. Launch files titled simulate\_<robotname>.launch are used to launch the gazebo simulation environment and rviz.
       }
 \item{
       Launch files titled view\_<robot>.launch are used to view the robots urdf model in rviz.
       }
\end{itemize}


% TODO: complete the section on how to scale and manipulate stl files so that the mesh could be easily integrated into rviz

\section{Mesh Manipulation}
\subsection{Reducing the quality of a mesh}
In most cases, the generated meshes are too large for gazebo to render at a high framerate. Thus, we would have to reduce the resolution of our meshes.
\begin{enumerate}
 \item {
       Open meshlab and import the mesh (file > import mesh)
       }
 \item{
       Click on Filters > Remeshing, Simplification and Reconstruction >  Quadratic edge collapse decimation
       }
 \item{
       Select a lower number of (target number of faces) and click apply.
       }
 \item{
       click on file > export mesh as > (enter mesh name and select \emph{.stl} file type)
       }
\end{enumerate}
% TODO: add in a section on how to simply meshes in meshlab


\section{Gazebo World from 2D Map}
\subsection{Setup \& Installation}

\begin{enumerate}
 \item{
       Ensure that the map server is installed on your system.
       \begin{lstlisting}[language=bash]
     $ sudo apt install ros-melodic-map-server
       \end{lstlisting}
       }
 \item{
       Clone the \href{https://github.com/SynapseProgramming/map2gazebo.git
       }{\emph{map2gazebo}} repository into your catkin/src folder.
       
       }
 \item{
       Navigate to the \emph{map2gazebo} package in your catkin/src folder and run the following commands.
       
       \begin{lstlisting}[language=bash]
         $ pip install --user trimesh
         $ pip install --user numpy
         $ pip install --user pycollada
         $ pip install --user scipy
         $ pip install --user networkx
       \end{lstlisting}
       }
 \item{
       Lastly, navigate to your catkin\_ws folder and run catkin\_make
       }
\end{enumerate}

\subsection{Generation of map.stl file}

\begin{enumerate}
 \item{launch roscore}
 \item {
       Navigate to the folder containing the \emph{pgm} and \emph{yaml} file for the map that you would want to convert and run the following command to launch the map server.
       \begin{lstlisting}[language=bash]
        $ rosrun map_server map_server <map name>.yaml
       \end{lstlisting}
       }
 \item{
       Then, run the following command to generate the \emph{map.stl} at a given directory. (replace
       \emph{/home/roald/Desktop/generatedmaps} with your own path)
       
       \begin{lstlisting}[language=bash]
        $ roslaunch map2gazebo map2gazebo.launch export_dir:=/home/roald/Desktop/generatedmaps
        \end{lstlisting}
       }
\end{enumerate}
\subsection{Importing the mesh into Gazebo}
\begin{enumerate}
 \item {
       Firstly, navigate to the following directory
       \begin{lstlisting}[language=bash]
 catkin_ws/src/map2gazebo/models/map/meshes
        \end{lstlisting}
       }
 \item {
       Replace the existing map.stl file with the newly generated map.stl file.
       }
 \item{
       Launch the following command to launch the gazebo simulation with the current robot in the new map.
       \begin{lstlisting}[language=bash]
       $ roslaunch fake_world simulate_cub_lab.launch
        \end{lstlisting}
       
       }
\end{enumerate}
\end{document}
